<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yaren & Mahir â€” NiÅŸan AlbÃ¼mÃ¼</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Cinzel:wght@400;600&family=Raleway:wght@200;300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root{--gold:#a67c45;--gold-light:#c9a96e;--gold-dark:#7a5828;--cream-bg:#f5ede0;--cream-card:#fff8ee;--text-dark:#3d2e1a;--text-mid:#6b4f2e;--rose:#c0665d;--green:#3a5f35;--border:rgba(166,124,69,0.28);--shadow:0 4px 24px rgba(166,124,69,0.1);}
*{margin:0;padding:0;box-sizing:border-box;}html{scroll-behavior:smooth;}
body{background:var(--cream-bg);color:var(--text-dark);font-family:'Raleway',sans-serif;min-height:100vh;}
.site-header{text-align:center;padding:52px 20px 36px;background:linear-gradient(to bottom,#eeddd0,var(--cream-bg));border-bottom:1px solid var(--border);}
.header-ornament{font-size:1rem;color:var(--gold-light);letter-spacing:0.7em;display:block;margin-bottom:16px;}
.header-sub{font-family:'Cinzel',serif;font-size:clamp(0.55rem,1.3vw,0.68rem);letter-spacing:0.45em;color:var(--gold);text-transform:uppercase;margin-bottom:10px;display:block;}
.header-title{font-family:'Cormorant Garamond',serif;font-size:clamp(2.4rem,7vw,5rem);font-weight:300;line-height:1;color:var(--text-dark);}
.header-title .amp{font-style:italic;color:var(--gold);font-size:0.65em;margin:0 0.15em;}
.header-tag{font-family:'Cinzel',serif;font-size:clamp(0.5rem,1.2vw,0.62rem);letter-spacing:0.4em;color:var(--text-mid);text-transform:uppercase;margin-top:10px;display:block;}
.divider-thin{display:flex;align-items:center;gap:12px;margin:18px auto 0;width:fit-content;}
.divider-thin .dl{width:60px;height:1px;background:linear-gradient(to right,transparent,var(--gold));}
.divider-thin .dl.r{background:linear-gradient(to left,transparent,var(--gold));}
.divider-thin .dd{width:6px;height:6px;background:var(--gold);transform:rotate(45deg);}
.tabs-wrap{display:flex;justify-content:center;padding:28px 20px 0;max-width:700px;margin:0 auto;}
.tab-btn{flex:1;padding:14px 20px;background:transparent;border:1px solid var(--border);font-family:'Cinzel',serif;font-size:clamp(0.5rem,1.4vw,0.65rem);letter-spacing:0.3em;text-transform:uppercase;color:var(--text-mid);cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:8px;}
.tab-btn:first-child{border-right:none;}
.tab-btn.active{background:var(--gold);color:#fff8ee;border-color:var(--gold);}
.tab-btn:not(.active):hover{background:rgba(166,124,69,0.07);color:var(--gold-dark);}
.section{display:none;max-width:1200px;margin:0 auto;padding:40px 20px 80px;}
.section.active{display:block;}
.section-heading{font-family:'Cinzel',serif;font-size:clamp(0.55rem,1.3vw,0.68rem);letter-spacing:0.45em;color:var(--gold);text-transform:uppercase;text-align:center;margin-bottom:32px;display:flex;align-items:center;gap:14px;justify-content:center;}
.section-heading::before,.section-heading::after{content:'';flex:1;max-width:80px;height:1px;background:var(--border);}
.gallery-toolbar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:24px;}
.gallery-count{font-size:0.78rem;color:var(--text-mid);font-weight:300;}
.toolbar-right{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
.btn-sm{padding:9px 18px;font-family:'Cinzel',serif;font-size:0.55rem;letter-spacing:0.25em;text-transform:uppercase;border:1px solid var(--border);background:transparent;color:var(--text-mid);cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:6px;white-space:nowrap;}
.btn-sm:hover{background:rgba(166,124,69,0.08);border-color:var(--gold);color:var(--gold-dark);}
.btn-sm.primary{background:var(--gold);color:#fff8ee;border-color:var(--gold);}
.btn-sm.primary:hover{background:var(--gold-dark);}
.btn-sm.primary:disabled{opacity:0.5;cursor:not-allowed;}
.btn-sm.danger{background:var(--rose);color:#fff;border-color:var(--rose);}
.btn-sm.danger:hover{background:#a0443b;}
#select-counter{display:none;}
#select-counter.visible{display:flex;}
.photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;}
.photo-card{animation:fadeIn 0.5s both;}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
.photo-card-inner{position:relative;border-radius:2px;overflow:hidden;aspect-ratio:4/3;background:#e8ddd0;border:1px solid var(--border);box-shadow:var(--shadow);cursor:pointer;}
.photo-card-inner img{width:100%;height:100%;object-fit:cover;display:block;transition:transform 0.4s ease;}
.photo-card-inner:hover img{transform:scale(1.04);}
.photo-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(30,15,5,0.85) 0%,rgba(30,15,5,0.1) 55%,transparent 100%);opacity:0;transition:opacity 0.3s;display:flex;align-items:flex-end;}
.photo-card-inner:hover .photo-overlay{opacity:1;}
.photo-overlay-content{padding:12px 12px 10px;width:100%;}
.photo-uploader{font-family:'Cinzel',serif;font-size:0.58rem;letter-spacing:0.2em;color:rgba(255,248,238,0.9);margin-bottom:3px;}
.photo-note{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:0.82rem;color:rgba(255,248,238,0.72);line-height:1.4;margin-bottom:8px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
.photo-actions{display:flex;gap:6px;}
.btn-icon{width:32px;height:32px;border-radius:50%;background:rgba(255,248,238,0.15);border:1px solid rgba(255,248,238,0.3);color:#fff8ee;font-size:0.72rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s;backdrop-filter:blur(4px);}
.btn-icon:hover{background:rgba(166,124,69,0.7);border-color:var(--gold-light);}
.select-checkbox{position:absolute;top:10px;right:10px;cursor:pointer;z-index:2;display:none;}
.select-checkbox.show{display:block;}
.select-checkbox input{display:none;}
.checkmark{width:26px;height:26px;border:2px solid rgba(255,248,238,0.7);border-radius:50%;background:rgba(30,15,5,0.3);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;transition:all 0.2s;font-size:0.65rem;color:transparent;}
.select-checkbox input:checked + .checkmark{background:var(--gold);border-color:var(--gold);color:#fff;}
#gallery-loader{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;padding:80px 0;color:var(--gold);}
#gallery-loader i{font-size:2rem;animation:spin 1.2s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
#empty-state{display:none;text-align:center;padding:80px 20px;color:var(--text-mid);}
#empty-state i{font-size:3rem;color:var(--border);margin-bottom:16px;display:block;}
#empty-state p{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.2rem;}
.lightbox{position:fixed;inset:0;z-index:1000;background:rgba(20,10,4,0.96);display:none;align-items:center;justify-content:center;flex-direction:column;padding:20px;}
.lightbox.open{display:flex;}
.lightbox-img-wrap{max-width:min(90vw,900px);max-height:72vh;display:flex;align-items:center;justify-content:center;}
.lightbox-img-wrap img{max-width:100%;max-height:72vh;object-fit:contain;border:1px solid rgba(166,124,69,0.3);box-shadow:0 8px 60px rgba(0,0,0,0.6);}
.lightbox-info{margin-top:20px;text-align:center;max-width:600px;}
.lightbox-name{font-family:'Cinzel',serif;font-size:0.62rem;letter-spacing:0.3em;color:var(--gold-light);text-transform:uppercase;margin-bottom:8px;}
.lightbox-note{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:1.1rem;color:rgba(245,237,224,0.8);line-height:1.6;margin-bottom:16px;}
.lightbox-actions{display:flex;gap:12px;justify-content:center;}
.lightbox-close{position:absolute;top:16px;right:16px;width:44px;height:44px;border-radius:50%;background:rgba(255,248,238,0.08);border:1px solid rgba(255,248,238,0.15);color:#fff8ee;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background 0.2s;z-index:10;}
.lightbox-close:hover{background:rgba(166,124,69,0.5);}
.upload-card{max-width:580px;margin:0 auto;border:1px solid var(--border);background:var(--cream-card);box-shadow:var(--shadow);padding:44px 40px;position:relative;}
.upload-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(to right,transparent,var(--gold),transparent);}
.upload-notice{background:linear-gradient(135deg,#fff8ee,#f5ede0);border:1px solid var(--border);border-left:3px solid var(--gold);padding:14px 16px;margin-bottom:24px;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:0.98rem;color:var(--text-mid);line-height:1.6;}
.upload-notice i{color:var(--gold);margin-right:6px;}
.device-code-notice{background:rgba(166,124,69,0.07);border:1px solid var(--border);padding:12px 16px;margin-bottom:24px;font-size:0.78rem;color:var(--text-mid);display:flex;align-items:center;gap:10px;line-height:1.5;}
.device-code-notice i{color:var(--gold);flex-shrink:0;}
.form-field{margin-bottom:22px;}
.form-label{font-family:'Cinzel',serif;font-size:0.58rem;letter-spacing:0.35em;color:var(--gold);text-transform:uppercase;display:block;margin-bottom:8px;}
.form-required{color:var(--rose);margin-left:3px;}
.form-input,.form-textarea{width:100%;padding:12px 14px;background:#fdf8f2;border:1px solid var(--border);font-family:'Raleway',sans-serif;font-size:0.9rem;color:var(--text-dark);font-weight:300;outline:none;transition:border-color 0.3s;border-radius:0;}
.form-input::placeholder,.form-textarea::placeholder{color:rgba(107,79,46,0.45);}
.form-input:focus,.form-textarea:focus{border-color:var(--gold);}
.form-textarea{resize:vertical;min-height:90px;}
.file-drop{border:2px dashed var(--border);padding:36px 20px;text-align:center;cursor:pointer;transition:border-color 0.3s,background 0.3s;background:#fdf8f2;}
.file-drop:hover,.file-drop.drag-over{border-color:var(--gold);background:rgba(166,124,69,0.05);}
.file-drop input{display:none;}
.file-drop i{font-size:2rem;color:var(--gold-light);display:block;margin-bottom:10px;}
.file-drop-text{font-size:0.82rem;color:var(--text-mid);font-weight:300;}
.file-drop-sub{font-size:0.7rem;color:rgba(107,79,46,0.5);margin-top:4px;}
#file-preview{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;}
.preview-thumb{width:60px;height:60px;object-fit:cover;border:1px solid var(--border);border-radius:2px;}
.upload-btn-wrap{margin-top:28px;text-align:center;}
.btn-upload{padding:15px 44px;background:var(--gold);color:#fff8ee;border:none;font-family:'Cinzel',serif;font-size:0.62rem;letter-spacing:0.35em;text-transform:uppercase;cursor:pointer;display:inline-flex;align-items:center;gap:10px;transition:background 0.3s,transform 0.2s;}
.btn-upload:hover:not(:disabled){background:var(--gold-dark);transform:translateY(-1px);}
.btn-upload:disabled{opacity:0.6;cursor:not-allowed;}
#upload-progress{display:none;margin-top:20px;}
.progress-track{height:3px;background:var(--border);border-radius:2px;overflow:hidden;margin-bottom:8px;}
#progress-bar-fill{height:100%;background:linear-gradient(to right,var(--gold-light),var(--gold));width:0%;transition:width 0.3s;border-radius:2px;}
#upload-status{font-size:0.75rem;color:var(--gold-dark);text-align:center;font-weight:300;}
.modal-overlay{position:fixed;inset:0;z-index:2000;background:rgba(20,10,4,0.7);display:none;align-items:center;justify-content:center;padding:20px;}
.modal-overlay.open{display:flex;}
.modal-box{background:var(--cream-card);border:1px solid var(--border);box-shadow:0 8px 60px rgba(0,0,0,0.2);padding:40px 36px;max-width:520px;width:100%;position:relative;text-align:center;max-height:90vh;overflow-y:auto;}
.modal-box::before{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(to right,transparent,var(--gold),transparent);}
.modal-title{font-family:'Cinzel',serif;font-size:0.7rem;letter-spacing:0.4em;color:var(--gold);text-transform:uppercase;margin-bottom:16px;}
.modal-body{font-family:'Cormorant Garamond',serif;font-size:1.05rem;color:var(--text-mid);line-height:1.7;margin-bottom:20px;}
/* Cihaz kodu baÅŸarÄ± kutusu */
.success-device-box{margin:16px 0;padding:20px;background:linear-gradient(135deg,#fff8ee,#f5ede0);border:1px solid var(--border);text-align:center;}
.success-device-label{font-family:'Cinzel',serif;font-size:0.55rem;letter-spacing:0.35em;color:var(--gold);text-transform:uppercase;margin-bottom:6px;display:block;}
.success-device-val{font-family:'Cormorant Garamond',serif;font-size:1.4rem;color:var(--text-dark);letter-spacing:0.08em;display:block;}
.success-device-note{font-size:0.72rem;color:var(--text-mid);margin-top:6px;line-height:1.5;display:block;}
/* My photos */
.my-photos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px;margin:16px 0;max-height:280px;overflow-y:auto;}
.my-photo-item{position:relative;aspect-ratio:1;cursor:pointer;border:2px solid transparent;border-radius:2px;overflow:hidden;transition:border-color 0.2s;}
.my-photo-item img{width:100%;height:100%;object-fit:cover;display:block;}
.my-photo-item.selected{border-color:var(--rose);}
.my-photo-item .del-check{position:absolute;top:4px;right:4px;width:22px;height:22px;border-radius:50%;background:rgba(192,102,93,0.9);color:#fff;font-size:0.65rem;display:none;align-items:center;justify-content:center;}
.my-photo-item.selected .del-check{display:flex;}
.modal-actions{display:flex;gap:12px;justify-content:center;margin-top:20px;flex-wrap:wrap;}
.modal-close-btn{position:absolute;top:12px;right:14px;background:none;border:none;font-size:1.1rem;color:var(--text-mid);cursor:pointer;padding:4px 8px;}
.modal-close-btn:hover{color:var(--rose);}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);padding:12px 28px;font-size:0.82rem;border-radius:2px;z-index:3000;box-shadow:0 4px 20px rgba(0,0,0,0.2);max-width:90vw;text-align:center;display:none;}
.toast.error{background:#7a2a22;color:#ffeae8;}
.toast.success{background:var(--green);color:#e8f5e5;}
.site-footer{text-align:center;padding:28px 20px 40px;border-top:1px solid var(--border);font-family:'Cormorant Garamond',serif;font-style:italic;color:var(--gold-dark);font-size:1rem;}
@media(max-width:600px){.photo-grid{grid-template-columns:repeat(2,1fr);gap:10px;}.upload-card{padding:30px 20px;}.gallery-toolbar{flex-direction:column;align-items:flex-start;}.modal-box{padding:32px 22px;}}
@media(max-width:400px){.photo-grid{grid-template-columns:1fr;}}
</style>
</head>
<body>

<header class="site-header">
  <span class="header-ornament">âœ¦ &nbsp; âœ¦ &nbsp; âœ¦</span>
  <span class="header-sub">NiÅŸan AlbÃ¼mÃ¼ â€” 26 Nisan 2026</span>
  <h1 class="header-title">Yaren <span class="amp">&amp;</span> Mahir</h1>
  <span class="header-tag">AnÄ±larÄ±mÄ±zÄ± Birlikte Biriktirelim</span>
  <div class="divider-thin"><div class="dl"></div><div class="dd"></div><div class="dl r"></div></div>
</header>

<div class="tabs-wrap">
  <button class="tab-btn active" onclick="switchTab('gallery')" id="tab-gallery"><i class="fa-solid fa-images"></i> FotoÄŸraflar</button>
  <button class="tab-btn" onclick="switchTab('upload')" id="tab-upload"><i class="fa-solid fa-cloud-arrow-up"></i> FotoÄŸraf YÃ¼kle</button>
</div>

<!-- GALLERY -->
<div class="section active" id="section-gallery">
  <div class="section-heading">TÃ¼m AnÄ±lar</div>
  <div class="gallery-toolbar">
    <span class="gallery-count" id="gallery-count"></span>
    <div class="toolbar-right">
      <span class="btn-sm" id="select-counter"><i class="fa-solid fa-check-square"></i><span id="select-count-text">0 seÃ§ildi</span></span>
      <button class="btn-sm" onclick="toggleSelectMode()" id="btn-select-mode"><i class="fa-solid fa-object-group"></i> Ã‡oklu SeÃ§</button>
      <button class="btn-sm primary" id="btn-download-selected" onclick="downloadSelected()" style="display:none;"><i class="fa-solid fa-download"></i> SeÃ§ilenleri Ä°ndir</button>
      <button class="btn-sm danger" onclick="openMyPhotosModal()"><i class="fa-solid fa-trash"></i> FotoÄŸrafÄ±mÄ± Sil</button>
      <button class="btn-sm" onclick="loadPhotos()" title="Yenile"><i class="fa-solid fa-rotate-right"></i></button>
    </div>
  </div>
  <div id="gallery-loader"><i class="fa-solid fa-spinner"></i><span style="font-size:0.8rem;color:var(--text-mid);letter-spacing:0.1em;">FotoÄŸraflar yÃ¼kleniyor...</span></div>
  <div id="empty-state"><i class="fa-solid fa-camera"></i><p>HenÃ¼z fotoÄŸraf yÃ¼klenmemiÅŸ.</p><p style="margin-top:8px;font-size:0.8rem;color:rgba(107,79,46,0.6);">Ä°lk fotoÄŸrafÄ± siz yÃ¼kleyin!</p></div>
  <div class="photo-grid" id="photo-grid"></div>
</div>

<!-- UPLOAD -->
<div class="section" id="section-upload">
  <div class="section-heading">AnÄ± PaylaÅŸ</div>
  <div class="upload-card">
    <div class="upload-notice">
      <i class="fa-solid fa-circle-info"></i>
      LÃ¼tfen yalnÄ±zca <strong>niÅŸan gÃ¼nÃ¼nde</strong> Ã§ekilmiÅŸ fotoÄŸraflarÄ±nÄ±zÄ± ekleyiniz. BaÅŸka tÃ¼rde fotoÄŸraflar kullanmayÄ±nÄ±z.
    </div>
    <div class="device-code-notice">
      <i class="fa-solid fa-mobile-screen"></i>
      <span>YÃ¼klediÄŸiniz fotoÄŸraflar bu cihaza otomatik baÄŸlanÄ±r. FotoÄŸraflarÄ±nÄ±zÄ± silmek istediÄŸinizde <strong>aynÄ± cihazdan</strong> "FotoÄŸrafÄ±mÄ± Sil" butonunu kullanÄ±n.</span>
    </div>
    <div class="form-field">
      <label class="form-label" for="upload-name">AdÄ±nÄ±z <span class="form-required">*</span></label>
      <input class="form-input" type="text" id="upload-name" placeholder="AdÄ±nÄ±zÄ± girin" maxlength="60">
    </div>
    <div class="form-field">
      <label class="form-label">FotoÄŸraf <span class="form-required">*</span></label>
      <div class="file-drop" id="file-drop-zone" onclick="document.getElementById('upload-file').click()">
        <input type="file" id="upload-file" accept="image/*" multiple onchange="previewFiles(this)">
        <i class="fa-solid fa-image"></i>
        <p class="file-drop-text" id="file-label-text">FotoÄŸraf seÃ§in veya sÃ¼rÃ¼kleyin</p>
        <p class="file-drop-sub">JPG, PNG, HEIC Â· Birden fazla seÃ§ebilirsiniz</p>
      </div>
      <div id="file-preview"></div>
    </div>
    <div class="form-field">
      <label class="form-label" for="upload-note">Bir Åžeyler YazÄ±n <span style="color:var(--text-mid);font-size:0.85em;letter-spacing:0;">(isteÄŸe baÄŸlÄ±)</span></label>
      <textarea class="form-textarea" id="upload-note" placeholder="Bu anÄ±yla ilgili bir ÅŸeyler yazabilirsiniz..." maxlength="300"></textarea>
    </div>
    <div class="upload-btn-wrap">
      <button class="btn-upload" id="upload-btn" onclick="handleUpload()"><i class="fa-solid fa-cloud-arrow-up"></i> YÃ¼kle</button>
    </div>
    <div id="upload-progress">
      <div class="progress-track"><div id="progress-bar-fill"></div></div>
      <p id="upload-status"></p>
    </div>
  </div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightboxOutside(event)">
  <button class="lightbox-close" onclick="closeLightbox()"><i class="fa-solid fa-xmark"></i></button>
  <div class="lightbox-img-wrap"><img id="lightbox-img" src="" alt=""></div>
  <div class="lightbox-info">
    <p class="lightbox-name" id="lightbox-name"></p>
    <p class="lightbox-note" id="lightbox-note"></p>
    <div class="lightbox-actions">
      <button class="btn-sm primary" onclick="downloadCurrentLightbox()"><i class="fa-solid fa-download"></i> Ä°ndir</button>
    </div>
  </div>
</div>

<!-- SUCCESS MODAL -->
<div class="modal-overlay" id="modal-success">
  <div class="modal-box">
    <button class="modal-close-btn" onclick="closeModal('modal-success')"><i class="fa-solid fa-xmark"></i></button>
    <div style="font-size:2rem;margin-bottom:12px;">âœ“</div>
    <p class="modal-title">FotoÄŸraf YÃ¼klendi!</p>
    <p class="modal-body">FotoÄŸrafÄ±nÄ±z albÃ¼me eklendi. Bu cihazdan yÃ¼klediÄŸiniz tÃ¼m fotoÄŸraflarÄ± "FotoÄŸrafÄ±mÄ± Sil" butonuyla yÃ¶netebilirsiniz.</p>
    <div class="success-device-box">
      <span class="success-device-label">Cihaz Kodunuz</span>
      <span class="success-device-val" id="shown-device-code">â€”</span>
      <span class="success-device-note">Bu kod bu cihaza Ã¶zel olarak kaydedildi. AynÄ± cihazdan yÃ¼klediÄŸiniz tÃ¼m fotoÄŸraflarÄ±nÄ±z bu kodla baÄŸlÄ±dÄ±r.</span>
    </div>
    <div class="modal-actions">
      <button class="btn-sm primary" onclick="closeModal('modal-success');switchTab('gallery');loadPhotos();"><i class="fa-solid fa-images"></i> Galeriye Git</button>
    </div>
  </div>
</div>

<!-- MY PHOTOS MODAL -->
<div class="modal-overlay" id="modal-my-photos">
  <div class="modal-box">
    <button class="modal-close-btn" onclick="closeModal('modal-my-photos')"><i class="fa-solid fa-xmark"></i></button>
    <div style="font-size:1.8rem;margin-bottom:12px;color:var(--rose);"><i class="fa-solid fa-trash-can"></i></div>
    <p class="modal-title">FotoÄŸraflarÄ±mÄ± Sil</p>

    <!-- Cihaz kodu var: direkt fotoÄŸraflarÄ± gÃ¶ster -->
    <div id="step-has-code">
      <p class="modal-body" id="my-photos-info">Bu cihazdan yÃ¼klenen fotoÄŸraflar aranÄ±yor...</p>
      <div class="my-photos-grid" id="my-photos-grid"></div>
      <p id="select-error" style="color:var(--rose);font-size:0.8rem;min-height:1.2em;text-align:center;margin-top:8px;"></p>
      <div class="modal-actions">
        <button class="btn-sm" onclick="closeModal('modal-my-photos')">Kapat</button>
        <button class="btn-sm danger" id="btn-delete-selected" onclick="deleteSelectedPhotos()"><i class="fa-solid fa-trash"></i> SeÃ§ilenleri Sil</button>
      </div>
    </div>

    <!-- Cihaz kodu yok: bilgilendirme -->
    <div id="step-no-code" style="display:none;">
      <p class="modal-body">Bu cihazdan daha Ã¶nce fotoÄŸraf yÃ¼klenmemiÅŸ. FotoÄŸraf yÃ¼klemek iÃ§in "FotoÄŸraf YÃ¼kle" sekmesini kullanÄ±n.</p>
      <div class="modal-actions">
        <button class="btn-sm primary" onclick="closeModal('modal-my-photos');switchTab('upload');"><i class="fa-solid fa-cloud-arrow-up"></i> FotoÄŸraf YÃ¼kle</button>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<footer class="site-footer">Yaren &amp; Mahir â€” 26 Nisan 2026 &nbsp;â™¡</footer>

<script>
const CLOUD_NAME    = "dp4kalxzq";
const UPLOAD_PRESET = "nisan_album";
const UPLOAD_URL    = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;
const LIST_URL      = `https://res.cloudinary.com/${CLOUD_NAME}/image/list/nisan.json`;
const DEVICE_KEY    = 'nisan_device_id';

/* â”€â”€ CÄ°HAZ KODU â€” localStorage'dan al, yoksa Ã¼ret ve kaydet â”€â”€ */
function getDeviceId() {
  let id = localStorage.getItem(DEVICE_KEY);
  if (!id) {
    // Benzersiz kod: zaman damgasÄ± + rastgele
    const rand = Math.random().toString(36).slice(2,8).toUpperCase();
    const ts   = Date.now().toString(36).slice(-4).toUpperCase();
    id = `${rand}${ts}`;
    localStorage.setItem(DEVICE_KEY, id);
  }
  return id;
}

const DEVICE_ID = getDeviceId();

let _photoCache = [];

function showToast(msg, type='error') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = 'toast '+type;
  t.style.display = 'block';
  setTimeout(() => t.style.display='none', 4000);
}
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
function openModal(id)  { document.getElementById(id).classList.add('open'); }
function switchTab(tab) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('section-'+tab).classList.add('active');
  document.getElementById('tab-'+tab).classList.add('active');
}

/* â”€â”€ CONTEXT PARSER â”€â”€ */
function parseContext(r) {
  try {
    if (r.context && r.context.custom) {
      const c = r.context.custom;
      // decodeURIComponent uygula
      const out = {};
      for (const k in c) {
        try { out[k] = decodeURIComponent(c[k]); } catch { out[k] = c[k]; }
      }
      return out;
    }
    if (r.context && typeof r.context === 'string') {
      const obj = {};
      r.context.split('|').forEach(pair => {
        const idx = pair.indexOf('=');
        if (idx > -1) {
          try { obj[pair.slice(0,idx)] = decodeURIComponent(pair.slice(idx+1)); }
          catch { obj[pair.slice(0,idx)] = pair.slice(idx+1); }
        }
      });
      return obj;
    }
  } catch(e) {}
  return {};
}

/* â”€â”€ LOAD PHOTOS â”€â”€ */
async function loadPhotos() {
  const grid=document.getElementById('photo-grid'), empty=document.getElementById('empty-state'), loader=document.getElementById('gallery-loader');
  loader.style.display='flex'; grid.innerHTML=''; empty.style.display='none';
  try {
    const res = await fetch(LIST_URL + '?t=' + Date.now());
    if (!res.ok) throw new Error(res.status);
    const data = await res.json();
    _photoCache = (data.resources||[]).sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));
    loader.style.display='none';
    renderGrid(_photoCache);
  } catch(e) {
    loader.style.display='none'; empty.style.display='block';
    console.error('loadPhotos:', e);
  }
}

function renderGrid(resources) {
  const grid  = document.getElementById('photo-grid');
  const empty = document.getElementById('empty-state');
  grid.innerHTML='';
  if (!resources.length) { empty.style.display='block'; document.getElementById('gallery-count').textContent=''; return; }
  empty.style.display='none';
  document.getElementById('gallery-count').textContent = resources.length+' fotoÄŸraf';
  resources.forEach((r,i) => {
    const ctx  = parseContext(r);
    const name = ctx.name || 'Misafir';
    const note = ctx.note || '';
    const url  = r.secure_url || `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/${r.public_id}`;
    const pid  = r.public_id || '';
    const safeA = s => String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;');
    const safeJ = s => String(s).replace(/\\/g,'\\\\').replace(/'/g,"\\'");
    const card=document.createElement('div');
    card.className='photo-card'; card.style.animationDelay=(i*0.04)+'s';
    card.innerHTML=`
      <div class="photo-card-inner" onclick="openLightbox('${safeJ(url)}','${safeJ(name)}','${safeJ(note)}')">
        <img src="${safeA(url)}" alt="NiÅŸan fotoÄŸrafÄ±" loading="lazy">
        <div class="photo-overlay">
          <div class="photo-overlay-content">
            <p class="photo-uploader"><i class="fa-solid fa-user"></i> ${name}</p>
            ${note ? `<p class="photo-note">&ldquo;${note}&rdquo;</p>` : ''}
            <div class="photo-actions" onclick="event.stopPropagation()">
              <button class="btn-icon" title="Ä°ndir" onclick="downloadPhoto('${safeJ(url)}','${safeJ(pid)}')"><i class="fa-solid fa-download"></i></button>
            </div>
          </div>
        </div>
        <label class="select-checkbox" title="SeÃ§" onclick="event.stopPropagation()">
          <input type="checkbox" class="photo-select" data-url="${safeA(url)}" data-file="${safeA(pid)}">
          <span class="checkmark"><i class="fa-solid fa-check"></i></span>
        </label>
      </div>`;
    grid.appendChild(card);
  });
}

/* â”€â”€ UPLOAD â”€â”€ */
async function handleUpload() {
  const nameVal = document.getElementById('upload-name').value.trim();
  const noteVal = document.getElementById('upload-note').value.trim();
  const fileInp = document.getElementById('upload-file');
  const files   = fileInp.files;
  if (!nameVal)      { showToast('LÃ¼tfen adÄ±nÄ±zÄ± girin.'); return; }
  if (!files.length) { showToast('LÃ¼tfen en az bir fotoÄŸraf seÃ§in.'); return; }

  const btn=document.getElementById('upload-btn'), prog=document.getElementById('upload-progress'), bar=document.getElementById('progress-bar-fill'), status=document.getElementById('upload-status');
  btn.disabled=true; btn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> YÃ¼kleniyor...'; prog.style.display='block';

  let done=0;
  const newPhotos = [];

  try {
    for (const file of files) {
      const fd=new FormData();
      fd.append('file', file);
      fd.append('upload_preset', UPLOAD_PRESET);
      fd.append('tags', 'nisan');
      // Cihaz ID'si context'e kaydediliyor â€” ad ve not ile birlikte
      fd.append('context', `name=${encodeURIComponent(nameVal)}|note=${encodeURIComponent(noteVal)}|deviceId=${DEVICE_ID}`);

      const result = await new Promise((resolve,reject) => {
        const xhr=new XMLHttpRequest();
        xhr.open('POST', UPLOAD_URL);
        xhr.upload.onprogress=e => {
          if (e.lengthComputable) {
            const pct=Math.round(((done+e.loaded/e.total)/files.length)*100);
            bar.style.width=pct+'%';
            status.textContent=(done+1)+' / '+files.length+' yÃ¼kleniyor... %'+pct;
          }
        };
        xhr.onload=()=>{
          if(xhr.status===200){ done++; resolve(JSON.parse(xhr.responseText)); }
          else reject(new Error(xhr.status));
        };
        xhr.onerror=reject;
        xhr.send(fd);
      });
      newPhotos.push(result);
    }

    bar.style.width='100%'; status.textContent=files.length+' fotoÄŸraf yÃ¼klendi!';

    // Ã–nbelleÄŸe ekle ve galeriyi anÄ±nda gÃ¼ncelle
    newPhotos.forEach(r => {
      if (!_photoCache.find(c=>c.public_id===r.public_id)) {
        _photoCache.unshift(r);
      }
    });
    renderGrid(_photoCache);

    setTimeout(() => {
      btn.disabled=false; btn.innerHTML='<i class="fa-solid fa-cloud-arrow-up"></i> YÃ¼kle';
      prog.style.display='none'; bar.style.width='0';
      document.getElementById('upload-name').value='';
      document.getElementById('upload-note').value='';
      fileInp.value='';
      document.getElementById('file-preview').innerHTML='';
      document.getElementById('file-label-text').textContent='FotoÄŸraf seÃ§in veya sÃ¼rÃ¼kleyin';
      document.getElementById('shown-device-code').textContent = DEVICE_ID;
      openModal('modal-success');
    }, 800);
  } catch(e) {
    btn.disabled=false; btn.innerHTML='<i class="fa-solid fa-cloud-arrow-up"></i> YÃ¼kle'; prog.style.display='none';
    showToast('YÃ¼kleme baÅŸarÄ±sÄ±z. LÃ¼tfen tekrar deneyin.');
  }
}

/* â”€â”€ FILE PREVIEW â”€â”€ */
function previewFiles(input) {
  const preview=document.getElementById('file-preview'), label=document.getElementById('file-label-text');
  preview.innerHTML='';
  if (!input.files.length) { label.textContent='FotoÄŸraf seÃ§in veya sÃ¼rÃ¼kleyin'; return; }
  label.textContent=input.files.length+' fotoÄŸraf seÃ§ildi';
  Array.from(input.files).slice(0,12).forEach(file => {
    const reader=new FileReader();
    reader.onload=e => { const img=document.createElement('img'); img.className='preview-thumb'; img.src=e.target.result; preview.appendChild(img); };
    reader.readAsDataURL(file);
  });
}

const dropZone=document.getElementById('file-drop-zone');
dropZone.addEventListener('dragover',e=>{e.preventDefault();dropZone.classList.add('drag-over');});
dropZone.addEventListener('dragleave',()=>dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop',e=>{e.preventDefault();dropZone.classList.remove('drag-over');const inp=document.getElementById('upload-file');inp.files=e.dataTransfer.files;previewFiles(inp);});

/* â”€â”€ LIGHTBOX â”€â”€ */
let _lbUrl='', _lbFile='';
function openLightbox(url,name,note) {
  document.getElementById('lightbox-img').src=url;
  document.getElementById('lightbox-name').textContent=name?'ðŸ“· '+name:'';
  const ne=document.getElementById('lightbox-note');
  ne.textContent=note?'"'+note+'"':''; ne.style.display=note?'block':'none';
  _lbUrl=url;
  document.getElementById('lightbox').classList.add('open'); document.body.style.overflow='hidden';
}
function closeLightbox(){document.getElementById('lightbox').classList.remove('open');document.getElementById('lightbox-img').src='';document.body.style.overflow='';}
function closeLightboxOutside(e){if(e.target===document.getElementById('lightbox'))closeLightbox();}
document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeLightbox();closeModal('modal-my-photos');closeModal('modal-success');}});
function downloadCurrentLightbox(){downloadPhoto(_lbUrl,_lbUrl.split('/').pop());}

/* â”€â”€ DOWNLOAD â”€â”€ */
async function downloadPhoto(url,filename) {
  try {
    const res=await fetch(url); const blob=await res.blob();
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob);
    a.download=(filename||'nisan-foto')+'.jpg';
    a.click(); URL.revokeObjectURL(a.href);
  } catch { window.open(url,'_blank'); }
}

/* â”€â”€ MY PHOTOS MODAL â”€â”€ */
function openMyPhotosModal() {
  document.getElementById('select-error').textContent='';
  // Bu cihaza ait fotoÄŸraflarÄ± Ã¶nbellekten filtrele
  const mine = _photoCache.filter(r => {
    const ctx = parseContext(r);
    return ctx.deviceId === DEVICE_ID;
  });

  const hasCode = document.getElementById('step-has-code');
  const noCode  = document.getElementById('step-no-code');

  if (!mine.length) {
    hasCode.style.display='none'; noCode.style.display='block';
    openModal('modal-my-photos');
    return;
  }

  hasCode.style.display='block'; noCode.style.display='none';

  const grid = document.getElementById('my-photos-grid');
  grid.innerHTML='';
  mine.forEach(r => {
    const url = r.secure_url || `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/${r.public_id}`;
    const div = document.createElement('div');
    div.className='my-photo-item';
    div.dataset.pid=r.public_id;
    div.innerHTML=`<img src="${url}" loading="lazy"><span class="del-check"><i class="fa-solid fa-check"></i></span>`;
    div.addEventListener('click',()=>div.classList.toggle('selected'));
    grid.appendChild(div);
  });

  document.getElementById('my-photos-info').textContent=`Bu cihazdan ${mine.length} fotoÄŸraf bulundu. Silmek istediklerinizi seÃ§in.`;
  openModal('modal-my-photos');
}

async function deleteSelectedPhotos() {
  const selected = Array.from(document.querySelectorAll('.my-photo-item.selected'));
  if (!selected.length) { document.getElementById('select-error').textContent='LÃ¼tfen en az bir fotoÄŸraf seÃ§in.'; return; }

  const btn=document.getElementById('btn-delete-selected');
  btn.disabled=true; btn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Siliniyor...';
  document.getElementById('select-error').textContent='';

  let successCount=0;
  for (const item of selected) {
    try {
      const res = await fetch('/.netlify/functions/delete-photo', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ publicId: item.dataset.pid, deviceId: DEVICE_ID })
      });
      const data = await res.json();
      if (res.ok && data.success) {
        _photoCache = _photoCache.filter(r=>r.public_id!==item.dataset.pid);
        item.remove();
        successCount++;
      }
    } catch(e){ console.error(e); }
  }

  btn.disabled=false; btn.innerHTML='<i class="fa-solid fa-trash"></i> SeÃ§ilenleri Sil';

  if (successCount>0) {
    renderGrid(_photoCache);
    showToast(successCount+' fotoÄŸraf silindi.','success');
    const remaining = document.querySelectorAll('.my-photo-item').length;
    if (remaining===0) closeModal('modal-my-photos');
    else document.getElementById('my-photos-info').textContent=`${remaining} fotoÄŸraf kaldÄ±.`;
  } else {
    document.getElementById('select-error').textContent='Silme iÅŸlemi baÅŸarÄ±sÄ±z oldu.';
  }
}

/* â”€â”€ SELECT MODE â”€â”€ */
let selectMode=false;
function toggleSelectMode(){
  selectMode=!selectMode;
  const btn=document.getElementById('btn-select-mode'),dlBtn=document.getElementById('btn-download-selected'),ctr=document.getElementById('select-counter');
  document.querySelectorAll('.select-checkbox').forEach(el=>{el.classList.toggle('show',selectMode);if(!selectMode)el.querySelector('input').checked=false;});
  if(selectMode){btn.innerHTML='<i class="fa-solid fa-xmark"></i> Ä°ptal';btn.classList.add('primary');dlBtn.style.display='flex';ctr.classList.add('visible');}
  else{btn.innerHTML='<i class="fa-solid fa-object-group"></i> Ã‡oklu SeÃ§';btn.classList.remove('primary');dlBtn.style.display='none';ctr.classList.remove('visible');}
  updateSelectCounter();
}
function updateSelectCounter(){document.getElementById('select-count-text').textContent=document.querySelectorAll('.photo-select:checked').length+' seÃ§ildi';}
document.addEventListener('change',e=>{if(e.target.classList.contains('photo-select'))updateSelectCounter();});

async function downloadSelected(){
  const checked=document.querySelectorAll('.photo-select:checked');
  if(!checked.length){showToast('LÃ¼tfen Ã¶nce fotoÄŸraf seÃ§in.');return;}
  const btn=document.getElementById('btn-download-selected');
  btn.disabled=true;btn.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Ä°ndiriliyor...';
  for(const cb of checked){await downloadPhoto(cb.dataset.url,cb.dataset.file);await new Promise(r=>setTimeout(r,500));}
  btn.disabled=false;btn.innerHTML='<i class="fa-solid fa-download"></i> SeÃ§ilenleri Ä°ndir';
  showToast(checked.length+' fotoÄŸraf indirildi.','success');
}

window.addEventListener('load', loadPhotos);
</script>
</body>
</html>
